# 連載：WindowsユーザーのためのDockerコンテナ入門（Azure活用編）

# Dockerコンテナの活用　アプリケーションの開発と配置

>アバナード　旭 哲男  
>2016/mm/dd

今回からは、Dockerを用いアプリケーションの開発から配置までの手順を解説していきたい。

第1回でも述べたが、Dockerは”仮想マシンをより軽量にした環境”であると同時に、
”コンテナをスタックしてシステムを構築できる”、”コンテナをリポジトリで管理することでバージョン管理ができる”
といったカスタマイズ・デプロイに特化した機能があり、CI（継続的インテグレーション）を実現するための
重要なテクノロジを提供するという側面がある。

今回は既存のDockerコンテナをカスタマイズし、アプリケーションを自分のDockerコンテナとして構築する
ところまでの手順を説明する。

アプリケーションはNode.jsコンテナを用いたマイクロサービスとして構築していく。
マイクロサービスの厳密な定義についてはWikiの[Microservices](https://en.wikipedia.org/wiki/Microservices)を
参照していただくとして、ここでは「互いに独立した、Dockerコンテナ上で動く軽量なサービス」として定義したい。

今回作成するアプリは、以下の２つのマイクロサービスで構成する。

- Twitterのツィートを収集しCassandraデータベースに保管する：　収集サービス
- 収集したツィートをWebブラウザから参照する：　参照サービス

> 実際には、マイクロサービスのほかにCassandraデータベースを初期化するタスクも作成するのだが、
> 便宜上上記２つのマイクロサービスを作るものとする。

本記事は、あくまでもDockerコンテナ作成のための手順を示すことがメインであるため、
それぞれのマイクロサービスの実装の詳細については、大まかに説明するのみであることを、ご了解いただきたい。

## アプリケーションの枠組みの作成とNode.js Dockerコンテナの準備

マイクロサービスを作成する前に、アプリケーションの構成を整理しておく。
今回作成する、マイクロサービスは以下の３つの構成要素からなる。

1. 外部システム（Twitter)のAPIをコールして、データを取得
1. その取得したデータをCassandraデータベースに保管
1. Cassandraデータベースの内容をWebブラウザに表示

それぞれ、Dockerコンテナ上で起動し、次の図のよう構成となる。

![microservice-structure](./microservice-structure.PNG)

### Twitter API呼び出し準備

マイクロサービスを実装する前に、Twitter APIを利用したいので、先にTwitterのアプリケーションIDを取得する。
[Twitter開発者向けのページ](https://dev.twitter.com/)をブラウザで開き、画面右上の *My apps*の
リンクをクリックする。

Sign inを促されるので、Twitterのアカウントでサインインする。もし、アカウントがなければ新規アカウントを作成してほしい。

つぎに、ｘｘの画面から、ｘｘとｘｘを入力しアカウントIDを入手する。
このあと作成するマイクロサービスでこのアカウントIDを使用するので控えておくこと。

### Gitリポジトリの準備（任意）

マイクロサービスを実装するうえで、Dockerコンテナにマイクロサービスのソースコードを展開する必要がある。
すでに、Githubにアカウントがある、またはVisual Studio Onlineのアカウントがあるのであれば
マイクロサービスのソースコードを管理するためのリポジトリを用意すると展開が楽になる。
具体的な手順については、各サービスのマニュアルを参照してほしい。

なお、Gitリポジトリを持たない場合には、Azureストレージサービスの共有ファイルサービスを使用することで
ソースコードを展開することは可能である。
ただし、ソースの修正のたびに、共有ファイルサービスにファイルをコピーし、Dockerホスト上から
Dockerコンテナの停止・削除・再起動といった手間が必要となるためおすすめはしない。

### アプリケーションの枠組みを作成する




## Dockerコンテナのビルドと実行

## Dockerリポジトリの作成

## Dockerコンテナの配置